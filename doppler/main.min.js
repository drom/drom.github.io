!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,(function(r){return o(e[i][1][r]||r)}),p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";const genSVG=require("onml/gen-svg"),stringify=require("onml/stringify"),genKeyHandler=require("./gen-key-handler.js"),genRenderWavesGL=require("./gen-render-waves-gl.js"),genOnWheel=require("./gen-on-wheel.js");module.exports=(content,desc)=>{desc.t0=desc.t0||0,desc.xScale|=8;const pstate={xScale:desc.xScale,xScaleMax:100,yOffset:0,yStep:50,yDuty:.7,sidebarWidth:220,numLanes:desc.view.length,t0:desc.t0,time:desc.time},els=(els=>Object.keys(els).reduce(((res,name)=>{const ml=els[name],el=document.createElement(ml[0]),attr="object"==typeof ml[1]?ml[1]:{};return attr.class&&el.classList.add(attr.class),attr.style&&el.setAttribute("style",attr.style),res[name]=el,res}),{}))({container:["div",{class:"wd-container",style:"height: inherit; min-height: inherit; max-height: inherit; background-color: #111; overflow: hidden; position: relative; scrollbar-color: #555 #222;"}],view0:["div",{class:"view",style:"position: absolute; left: 0px;"}],cursor:["div",{class:"cursor",style:"position: absolute; top: 0px; left: 0px;"}],sidebar:["div",{class:"sidebar",style:"background-color: #222e; position: absolute; overflow: hidden; left: 0px; z-index: 2;"}]});[els.view0,els.cursor,els.sidebar].map((e=>els.container.appendChild(e))),content.appendChild(els.container),els.sidebar.innerHTML=stringify(((desc,pstate)=>genSVG(pstate.sidebarWidth,desc.view.length*(pstate.yStep/2+1)).concat(desc.view.map(((e,i)=>{if(null===e||"object"!=typeof e||void 0===e.name){const y=pstate.yStep/2*(i+1.2);return["line",{class:"spacer",x1:5,x2:pstate.sidebarWidth-5,y1:y,y2:y}]}return["text",{class:"txt",x:10,y:pstate.yStep/2*(i+1.4)},e.name]}))))(desc,pstate));let render=genRenderWavesGL(els.view0,els.sidebar)(desc)(pstate);els.container.tabIndex="0",els.container.addEventListener("keydown",genKeyHandler(content,pstate,render)),els.container.addEventListener("mousewheel",genOnWheel(content,pstate,render));const resizeHandler=(width,height)=>{const{time:time,sidebarWidth:sidebarWidth}=pstate;pstate.width=width,pstate.height=height,pstate.xScaleMin=2*(width-sidebarWidth)/time,pstate.sidebarOffset=2*sidebarWidth/width,pstate.xOffset=pstate.sidebarOffset};new ResizeObserver((entries=>{for(let entry of entries){const{width:width,height:height}=entry.contentRect;resizeHandler(width,height)}render()})).observe(els.container),resizeHandler(els.container.clientWidth,els.container.clientHeight),((cursor,content,pstate)=>{const handler=event=>{const x=event.clientX,ml=genSVG(3,pstate.height).concat([["line",{class:"cursor",x1:.5,x2:.5,y1:0,y2:pstate.height}]]);cursor.setAttribute("style","position: absolute; top: 0px; left: "+x+"px;"),cursor.innerHTML=stringify(ml)};handler({clientX:pstate.width/2}),content.addEventListener("mousemove",handler)})(els.cursor,els.container,pstate),render()}},{"./gen-key-handler.js":2,"./gen-on-wheel.js":3,"./gen-render-waves-gl.js":4,"onml/gen-svg":7,"onml/stringify":8}],2:[function(require,module,exports){"use strict";const scale=require("./scale.js");module.exports=(div,pstate,render)=>event=>{console.log(event.key),(scale[event.key]||scale.nop)(pstate)&&render()}},{"./scale.js":6}],3:[function(require,module,exports){"use strict";const scale=require("./scale.js");module.exports=(element,pstate,render)=>event=>{event.preventDefault();const{deltaY:deltaY}=event;event.ctrlKey?scale[deltaY<0?"+":deltaY>0?"-":"nop"](pstate)&&render():event.shiftKey?scale[deltaY<0?"ArrowLeft":deltaY>0?"ArrowRight":"nop"](pstate)&&render():scale[deltaY<0?"ArrowUp":deltaY>0?"ArrowDown":"nop"](pstate)&&render()}},{"./scale.js":6}],4:[function(require,module,exports){"use strict";const cColors=new Float32Array([0,0,0,0,0,0,1,1,0,1,0,1,0,1,1,1,1,0,0,1,.5,1,1,1,1,1,0,1,1,1,1,1]),cTilts=new Float32Array([0,0,1,-1,1,0,1,1,-1,-1,-1,0,-1,1]),shaderer=(kind,src)=>gl=>{const vShader=gl.createShader(gl[kind]);return gl.shaderSource(vShader,src),gl.compileShader(vShader),vShader},vertexShaderScalar=shaderer("VERTEX_SHADER","#version 300 es\nin uvec3 pos;\nout vec4 v_color;\nuniform vec2 scale;\nuniform vec2 offset;\nuniform vec4 colors[8];\nuniform vec2 tilts[7];\nuniform float tilt;\nvoid main() {\n  v_color = colors[pos.z];\n  vec2 node = tilts[pos.y];\n  gl_Position = vec4(\n    float(pos.x) * scale.x + offset.x + node[1] * tilt,\n    float(node[0]) * scale.y + offset.y,\n    1, 1\n  );\n}\n"),fragmentShader=shaderer("FRAGMENT_SHADER","#version 300 es\nprecision mediump float;\nin vec4 v_color;\nout vec4 myOutputColor;\nvoid main() {\n  myOutputColor = v_color;\n}\n"),bar=[(f,t,a,b,c0,c1)=>[].concat(1===f?[a,2,c1]:[],[a,5,c0],[b,5,c0],t>1?[b,0,c0]:[]),(f,t,a,b,c0,c1)=>[].concat(0===f?[a,5,c0]:f>1?[a,0,c0]:[],[a,2,c1],[b,2,c1],t>1?[b,0,c0]:[]),(f,t,a,b,c0,c1)=>[a,0,c0,b,0,c1]],brick=[(f,t,a,b,c0,c1)=>[].concat(0===f?[a,5,c0]:1===f?[a,1,c1]:[],[a,6,c0],0===t?[b,5,c0]:[b,4,c0],3===t?[b,0,c0]:[]),(f,t,a,b,c0,c1)=>[].concat(0===f?[a,4,c0,a,3,c1]:1===f?[a,2,c1]:2===f?[a,3,c1]:[a,0,c0,a,3,c1],1===t?[b,3,c1]:[b,1,c1],3===t?[b,0,c0]:[]),(f,t,a,b,c0,c1)=>[].concat(0===f?[a,4,0]:1===f?[a,1,0]:[a,0,0],0===t?[b,6,0,b,6,c0]:1===t?[b,3,0,b,3,c1,b,4,c0]:[b,0,0,b,0,c0,b,4,c0],0===f?[a,4,c0,a,3,c1]:1===f?[a,6,c0,a,1,c1]:[a,6,c0,a,0,c0,a,3,c1],0===t?[b,1,c1,b,6,c0]:1===t?[b,3,c1]:[b,1,c1,b,0,c0])];module.exports=(dummy,sidebar)=>{const cnvs=document.createElement("canvas");dummy.replaceChildren(cnvs),cnvs.style="background-color: #111;";const gl=cnvs.getContext("webgl2",{premultipliedAlpha:!1,alpha:!0,antialias:!1,depth:!1}),loco=(gl=>{const program=gl.createProgram();return gl.attachShader(program,vertexShaderScalar(gl)),gl.attachShader(program,fragmentShader(gl)),gl.linkProgram(program),gl.useProgram(program),"colors tilts scale offset tilt".split(/\s+/).reduce(((res,name)=>Object.assign(res,{[name]:gl.getUniformLocation(program,name)})),{pos:gl.getAttribLocation(program,"pos"),gl:gl})})(gl);return desc=>((desc=>{desc.view.map((lane=>{if(!lane||void 0===lane.ref)return;const chang=desc.chango[lane.ref],{kind:kind,wave:wave}=chang;if(lane.kind=kind,lane.wave=wave,"bit"===kind){const vertices=[],ilen=wave.length;for(let i=0;i<ilen;i++){const f=wave[0===i?0:i-1],c=wave[i],t=wave[i===ilen-1?i:i+1],tt=i===ilen-1?desc.time:wave[i+1][0];vertices.push(...bar[c[1]](f[1],t[1],c[0],tt,2,3))}lane.vertices=new Uint16Array(vertices)}if("vec"===kind){const vertices=[],ilen=wave.length;for(let i=0;i<ilen;i++){const c=wave[i],tt=i===ilen-1?desc.time:wave[i+1][0];vertices.push(...brick[2](2,2,c[0],tt,5,5))}lane.vertices=new Uint16Array(vertices)}}))})(desc),((loco,desc)=>{desc.view.map((lane=>{if(!lane||void 0===lane.vertices)return;const vertices=lane.vertices,gl=loco.gl,vertexBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW),lane.vao=gl.createVertexArray(),gl.bindVertexArray(lane.vao),gl.vertexAttribIPointer(loco.pos,3,gl.UNSIGNED_SHORT,0,0),gl.enableVertexAttribArray(loco.pos),gl.uniform4fv(loco.colors,cColors),gl.uniform2fv(loco.tilts,cTilts)}))})(loco,desc),pstate=>()=>{let{width:width,height:height,xScale:xScale,xOffset:xOffset,yOffset:yOffset,yStep:yStep,yDuty:yDuty,sidebarWidth:sidebarWidth}=pstate;cnvs.width=width,cnvs.height=height,gl.uniform1f(loco.tilt,3/width),gl.uniform2f(loco.scale,xScale/width,yStep*yDuty/height/2),gl.viewport(0,0,width,height),desc.view.map(((lane,idx)=>{lane&&void 0!==lane.vertices&&(gl.bindVertexArray(lane.vao),gl.uniform2f(loco.offset,xOffset-1,yOffset+1-(yStep*idx+60)/height),gl.drawArrays(gl.LINE_STRIP,0,lane.vertices.length/3))})),sidebar.style.top=-(yOffset*height*.5|0)+"px",sidebar.style.width=sidebarWidth+"px"})}},{}],5:[function(require,module,exports){(function(global){(function(){"use strict";const domContainer=require("./dom-container.js");global.DopplerGL=async(divName,changoURI,namesURI)=>{const opt={},content="string"==typeof divName?document.getElementById(divName):divName;let desc;if(null==namesURI){const src=content.innerHTML;content.innerHTML="",desc=JSON.parse(src)}else{const responce=await fetch(namesURI);desc=await responce.json()}if(void 0===changoURI||void 0===changoURI)domContainer(content,desc,opt);else{const responce=await fetch(changoURI),data=await responce.json();desc=Object.assign(data,desc),domContainer(content,desc,opt)}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./dom-container.js":1}],6:[function(require,module,exports){"use strict";const plus=pstate=>{let{xScale:xScale,xScaleMax:xScaleMax}=pstate;return xScale!==xScaleMax&&(xScale+=xScale/2,xScale>xScaleMax&&(xScale=xScaleMax),pstate.xScale=xScale,!0)},minus=pstate=>{let{xScale:xScale,xScaleMin:xScaleMin,xOffset:xOffset,time:time,width:width}=pstate;if(xScale===xScaleMin)return!1;xScale-=xScale/3,xScale<xScaleMin&&(xScale=xScaleMin);const xOffsetMin=2-xScale*time/width;return pstate.xScale=xScale,xOffset<xOffsetMin&&(pstate.xOffset=xOffsetMin),!0},full=pstate=>{const{xScale:xScale,xScaleMin:xScaleMin,xOffset:xOffset,sidebarOffset:sidebarOffset}=pstate;return(xScale!==xScaleMin||0!==xOffset)&&(pstate.xScale=xScaleMin,pstate.xOffset=sidebarOffset,!0)},up=delta=>pstate=>{let{yOffset:yOffset}=pstate;return 0!==yOffset&&(yOffset-=delta,yOffset<0&&(yOffset=0),pstate.yOffset=yOffset,!0)},down=delta=>pstate=>{let{yOffset:yOffset,yStep:yStep,numLanes:numLanes,height:height}=pstate;const yOffsetMax=(numLanes+2)*yStep/height-2;return yOffset!==yOffsetMax&&(yOffset+=delta,yOffset>yOffsetMax&&(yOffset=yOffsetMax),pstate.yOffset=yOffset,!0)};module.exports={"+":plus,"=":plus,"-":minus,_:minus,f:full,F:full,Home:pstate=>{let{xOffset:xOffset,sidebarOffset:sidebarOffset}=pstate;return xOffset!==sidebarOffset&&(pstate.xOffset=sidebarOffset,!0)},End:pstate=>{let{xOffset:xOffset,xScale:xScale,time:time,width:width}=pstate;const xOffsetMin=2-xScale*time/width;return xOffset!==xOffsetMin&&(pstate.xOffset=xOffsetMin,!0)},ArrowLeft:pstate=>{let{xOffset:xOffset,sidebarOffset:sidebarOffset}=pstate;return xOffset!==sidebarOffset&&(xOffset+=.1,xOffset>sidebarOffset&&(xOffset=sidebarOffset),pstate.xOffset=xOffset,!0)},ArrowRight:pstate=>{let{xOffset:xOffset,xScale:xScale,width:width,time:time}=pstate;const xOffsetMin=2-xScale*time/width;return xOffset!==xOffsetMin&&(xOffset-=.1,xOffset<xOffsetMin&&(xOffset=xOffsetMin),pstate.xOffset=xOffset,!0)},ArrowUp:up(.1),ArrowDown:down(.1),PageUp:up(2),PageDown:down(2),nop:()=>!1}},{}],7:[function(require,module,exports){"use strict";const w3_svg="http://www.w3.org/2000/svg",w3_xlink="http://www.w3.org/1999/xlink";module.exports=(w,h)=>["svg",{xmlns:w3_svg,"xmlns:xlink":w3_xlink,width:w,height:h,viewBox:"0 0 "+w+" "+h}]},{}],8:[function(require,module,exports){"use strict";module.exports=function(a,indentation){const cr=indentation>0?"\n":"",indent=function(indentation){if(!(indentation>0))return txt=>txt;var space=" ".repeat(indentation);return txt=>{if("string"!=typeof txt)return txt;const arr=txt.split("\n");return 1===arr.length?space+txt:arr.map((e=>""===e.trim()?e:space+e)).join("\n")}}(indentation);return function rec(a){let res,body="",isFlat=!0;return a.some(((e,i,arr)=>{if(0===i)return res="<"+e,1===arr.length;if(1===i){if((o=e)&&"[object Object]"===Object.prototype.toString.call(o))return Object.keys(e).map((key=>{let val=e[key];Array.isArray(val)&&(val=val.join(" ")),res+=" "+key+'="'+val+'"'})),2===arr.length||void(res+=">");res+=">"}var o;switch(typeof e){case"string":case"number":case"boolean":case"undefined":return void(body+=e+cr)}isFlat=!1,body+=rec(e)}))?res+"/>"+cr:isFlat?res+body.split("\n").filter((e=>""!==e.trim())).join("\n")+"</"+a[0]+">"+cr:res+cr+indent(body)+"</"+a[0]+">"+cr}(a)}},{}]},{},[5]);
